<!doctype html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Ufo</title>
    <meta name="description" content="Ufo">
    <meta name="author" content="Dawid Gustowski">

    <link rel="icon" href="./icon-512.png">
    <link rel="apple-touch-icon" href="./icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Dawid">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#04202a">

    <script src="./script.js"></script>
    <style>
/* Przyjemny, kontrastowy styl dostosowany do telefonu */
:root{
  --bg:#071014;
  --panel:#0b2a33;
  --accent:#7ce7d9;
  --danger:#ff6b6b;
  --glass: rgba(255,255,255,0.03);
  --card: rgba(255,255,255,0.04);
  --font: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:var(--font);
  background: linear-gradient(180deg,var(--bg), #04202a 120%);
  color:#eafaf6;
  -webkit-tap-highlight-color: transparent;

  overflow: hidden;              /* âœ… blokuje przewijanie */
  overscroll-behavior: none;     /* âœ… usuwa gumowanie */
}

#game{
  display:flex;
  flex-direction:column;
  min-height:100svh;   /* âœ… */
  gap:8px;
  padding:10px;
}

header{
  display:flex;align-items:center;justify-content:space-between;
  padding:6px 8px;border-radius:12px;background:linear-gradient(180deg,var(--panel), #07282f);
  box-shadow: 0 6px 18px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.03);
}
header h1{margin:0;font-size:18px;letter-spacing:1px}
#score{font-weight:700;font-size:16px}

#playfield{
  position:relative;flex:1;border-radius:12px;overflow:hidden;
  background:
    radial-gradient(1200px 300px at 10% 0%, rgba(124,231,217,0.04), transparent 10%),
    linear-gradient(180deg, rgba(255,255,255,0.02), transparent 20%),
    var(--glass);
  margin-top:4px;
  display:block;
}

/* UFO */
#ufo{
  position:absolute;bottom:18px;left:50%;
  transform:translateX(-50%);
  font-size:44px;
  width:64px;height:64px;border-radius:16px;
  display:flex;align-items:center;justify-content:center;
  user-select:none;touch-action:none;
  -webkit-user-drag:none;
  filter:drop-shadow(0 8px 14px rgba(0,0,0,0.6));
  transition: transform 0.08s linear;
}

/* Bomby */
.bomb{
  position:absolute;top:-80px;
  font-size:32px;
  width:44px;height:44px;display:flex;align-items:center;justify-content:center;
  pointer-events:none;
  will-change:transform;
  text-shadow: 0 2px 0 rgba(0,0,0,0.6);
}

/* overlayy */
.centered{
  position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
  z-index:50;
  pointer-events:auto;
}
#ui-overlay{z-index:40}
#gameover-overlay .card{
  background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
  padding:18px;border-radius:14px;text-align:center;min-width:230px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.6);
}
.hidden{display:none}

button.big{
  background:linear-gradient(180deg,var(--accent), #31cbbd);
  border:none;padding:12px 18px;border-radius:12px;font-size:16px;font-weight:700;
  color:#052525;cursor:pointer;box-shadow: 0 8px 18px rgba(7,30,30,0.45);
}
button.big:active{transform:translateY(1px)}

/* footer */
footer{font-size:12px;text-align:center;opacity:0.9;margin-top:4px}

/* adaptacja na maÅ‚e ekrany */
@media (max-width:420px){
  #ufo{font-size:40px;width:56px;height:56px;bottom:12px}
  .bomb{font-size:28px;width:40px;height:40px}
}
    </style>
</head>
<body>
  <div id="game">
    <header>
      <h1>Ufo</h1>
      <div id="score">Punkty: <span id="scoreValue">0</span></div>
    </header>

    <div id="playfield">
      <div id="ufo" aria-hidden="true">ðŸ›¸</div>
      <!-- bomby bÄ™dÄ… dodawane dynamicznie tutaj -->
    </div>

    <div id="ui-overlay" class="centered">
      <button id="startBtn" class="big">Rozpocznij GrÄ™</button>
    </div>

    <div id="gameover-overlay" class="centered hidden">
      <div class="card">
        <h2>Gra zakoÅ„czona</h2>
        <p>Uzyskany wynik: <span id="finalScore">0</span></p>
        <p>TwÃ³j rekord: <span id="bestScore">0</span></p>
        <button id="newGameBtn" class="big">Nowa Gra</button>
      </div>
    </div>
    <footer>
      <small>Steruj palcem lub myszkÄ…. Omijaj bomby ðŸ’£</small>
    </footer>
  </div>

  <script>
// 20250809_script.js
// Klucz localStorage
const RECORD_KEY = 'ufo_record';

const playfield = document.getElementById('playfield');
const ufo = document.getElementById('ufo');
const startBtn = document.getElementById('startBtn');
const uiOverlay = document.getElementById('ui-overlay');
const gameoverOverlay = document.getElementById('gameover-overlay');
const finalScoreEl = document.getElementById('finalScore');
const bestScoreEl = document.getElementById('bestScore');
const newGameBtn = document.getElementById('newGameBtn');
const scoreValueEl = document.getElementById('scoreValue');

let dawid108 = localStorage.getItem("dawid108") || 0;
let score = 0;
let bombsDropped = 0;
let running = false;
let spawnTimer = null;
let animationId = null;
let spawnInterval = 1200; // ms
let fallSpeedBase = 0.12; // pixels per ms multiplier
let difficultyLevel = 0; // increases every 10 punktÃ³w
let bombs = [];

// rozmiary i limity
function pfBounds() { return playfield.getBoundingClientRect(); }
function ufoBounds() { return ufo.getBoundingClientRect(); }

// pomoc: losuj int
function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

// --- sterowanie UFO (pointer events obsÅ‚ugujÄ… mysz/touch)
let dragging = false;
let pointerOffsetX = 0;

ufo.addEventListener('pointerdown', (e)=>{
  e.preventDefault();
  dragging = true;
  ufo.setPointerCapture(e.pointerId);
  const rect = ufo.getBoundingClientRect();
  pointerOffsetX = e.clientX - rect.left;
});

window.addEventListener('pointermove', (e)=>{
  if(!dragging) return;
  moveUfoTo(e.clientX - pointerOffsetX);
});

window.addEventListener('pointerup', (e)=>{
  if(dragging){
    dragging = false;
    try { ufo.releasePointerCapture(e.pointerId); } catch(e){}
  }
});

// Tap/click on playfield to move center of UFO
playfield.addEventListener('click', (e)=>{
  if(!running) return;
  moveUfoTo(e.clientX - ufo.offsetWidth/2);
});

function moveUfoTo(x){
  const pf = pfBounds();
  const minX = pf.left;
  const maxX = pf.right - ufo.offsetWidth;
  let target = x;
  if(target < minX) target = minX;
  if(target > maxX) target = maxX;
  const left = target - pf.left;
  ufo.style.left = `${left}px`;
  ufo.style.transform = `translateX(0)`;
}

// --- bomby
function createBomb(){
  const b = document.createElement('div');
  b.className = 'bomb';
  b.textContent = 'ðŸ’£';
  const pf = pfBounds();
  const minLeft = 6;
  const maxLeft = pf.width - 44 - 6;
  const x = randInt(minLeft, Math.max(minLeft, maxLeft));
  b.style.left = x + 'px';
  b.dataset.y = -80; 
  b.dataset.speed = (fallSpeedBase + difficultyLevel*0.03) + (Math.random()*0.05);
  playfield.appendChild(b);
  bombs.push(b);
}

function removeBomb(b){
  const idx = bombs.indexOf(b);
  if(idx !== -1) bombs.splice(idx,1);
  if(b && b.parentElement) b.parentElement.removeChild(b);
}

// --- funkcja decydujÄ…ca ile bomb spada naraz
function spawnBombWave(){
  if(score >= 200){
    for(let i=0;i<3;i++) createBomb();
  } else if(score >= 100){
    for(let i=0;i<2;i++) createBomb();
  } else {
    createBomb();
  }
}

// aktualizuj animacjÄ™
let lastTime = null;
function tick(ts){
  if(!running) return;
  if(!lastTime) lastTime = ts;
  const dt = ts - lastTime;
  lastTime = ts;

  const pf = pfBounds();
  for(let i = bombs.length-1;i>=0;i--){
    const b = bombs[i];
    const speed = parseFloat(b.dataset.speed) || 0.12;
    let y = parseFloat(b.dataset.y) || -80;
    y += speed * dt * 2;
    b.dataset.y = y;
    b.style.transform = `translateY(${y}px)`;

    if(y > pf.height){
      removeBomb(b);
      score += 1;
      dawid108++;
      localStorage.setItem("dawid108", dawid108);
      console.log("dawid108:", dawid108);
      bombsDropped += 1;
      scoreValueEl.textContent = score;

      // Reset i zmiana trudnoÅ›ci przy 100 i 200 punktach
      if(score === 100){
        difficultyLevel = 0;
        spawnInterval = 1000;
        fallSpeedBase = 0.10;
        bombsDropped = 0;
        restartSpawning();
      } else if(score === 200){
        difficultyLevel = 0;
        spawnInterval = 900;
        fallSpeedBase = 0.09;
        bombsDropped = 0;
        restartSpawning();
      } else if(bombsDropped % 10 === 0){
        increaseDifficulty();
      }
      continue;
    }

    const bRect = b.getBoundingClientRect();
    const uRect = ufoBounds();
    if(rectsIntersect(bRect, uRect)){
      endGame();
      return;
    }
  }

  animationId = requestAnimationFrame(tick);
}

// kolizja AABB
function rectsIntersect(a,b){
  return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom);
}

// zwiÄ™ksz trudnoÅ›Ä‡
function increaseDifficulty(){
  difficultyLevel += 1;
  spawnInterval = Math.max(300, spawnInterval - 120);
  bombs.forEach(b => {
    const cur = parseFloat(b.dataset.speed) || 0.12;
    b.dataset.speed = (cur + 0.03).toString();
  });
}

// startSpawning i restartSpawning z nowÄ… falÄ… bomb
function startSpawning(){
  if(spawnTimer) clearInterval(spawnTimer);
  spawnTimer = setInterval(()=>{
    spawnBombWave();
    if(Math.random() < 0.12 + difficultyLevel*0.03) createBomb();
  }, spawnInterval);
}

function restartSpawning(){
  if(spawnTimer) clearInterval(spawnTimer);
  spawnTimer = setInterval(()=>{
    spawnBombWave();
    if(Math.random() < 0.12 + difficultyLevel*0.03) createBomb();
  }, spawnInterval);
}

// start gry
function startGame(){
  score = 0; bombsDropped = 0; difficultyLevel = 0;
  spawnInterval = 1200; fallSpeedBase = 0.12;
  scoreValueEl.textContent = score;
  bombs.slice().forEach(removeBomb);
  uiOverlay.classList.add('hidden');
  gameoverOverlay.classList.add('hidden');
  running = true;
  lastTime = null;
  const pf = pfBounds();
  ufo.style.left = `${(pf.width - ufo.offsetWidth)/2}px`;

  spawnBombWave();
  startSpawning();
  animationId = requestAnimationFrame(tick);
}

// zakoÅ„czenie gry
function endGame(){
  running = false;
  if(spawnTimer) clearInterval(spawnTimer);
  if(animationId) cancelAnimationFrame(animationId);
  finalScoreEl.textContent = score;
  const prev = parseInt(localStorage.getItem(RECORD_KEY) || '0', 10);
  if(score > prev){
    localStorage.setItem(RECORD_KEY, score);
  }
  bestScoreEl.textContent = Math.max(score, prev);
  gameoverOverlay.classList.remove('hidden');
}

// inicjalizacja
function init(){
  const rec = parseInt(localStorage.getItem(RECORD_KEY) || '0', 10);
  bestScoreEl.textContent = rec;

  startBtn.addEventListener('click', ()=>{
    startGame();
    setTimeout(restartSpawning, 500);
  });

  newGameBtn.addEventListener('click', ()=>{
    startGame();
    setTimeout(restartSpawning, 500);
  });

  window.addEventListener('resize', ()=>{
    const pf = pfBounds();
    const uRect = ufo.getBoundingClientRect();
    let left = parseFloat(ufo.style.left || '0');
    if(left + uRect.width > pf.width) left = Math.max(0, pf.width - uRect.width);
    ufo.style.left = left + 'px';
  });

  playfield.addEventListener('pointerdown', (e)=>{
    if(!running) return;
    if(e.target === playfield) moveUfoTo(e.clientX - ufo.offsetWidth/2);
  });

  (function idleLoop(){
    if(!running){
      const t = Date.now()/800;
      const amp = 6;
      ufo.style.bottom = `${18 + Math.sin(t)*amp}px`;
    } else {
      ufo.style.bottom = '';
    }
    requestAnimationFrame(idleLoop);
  })();
}

init();
  </script>
</body>
</html>
