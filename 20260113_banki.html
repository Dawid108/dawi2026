<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>BaÅ„ki</title>
    <meta name="description" content="BaÅ„ki">
    <meta name="author" content="Dawid Gustowski">

    <link rel="icon" href="./icon-512.png">
    <link rel="apple-touch-icon" href="./icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Dawid">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#66a6ff">

    <script src="./script.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%); /* Wodny gradient */
            color: #333;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            touch-action: none; /* Blokada gestÃ³w systemowych */
            user-select: none;
            height: 100vh;
            width: 100vw;
        }

        #game-area {
            position: relative;
            width: 100%;
            height: 100%;
            cursor: crosshair; /* Kursor celownika */
        }

        #score-board {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            pointer-events: none; /* KlikniÄ™cia przenikajÄ… przez wynik */
            z-index: 10;
        }

        .bubble {
            position: absolute;
            font-size: 80px; /* DuÅ¼e baÅ„ki */
            line-height: 80px;
            cursor: pointer;
            z-index: 5;
            /* Animacja pojawiania siÄ™ (pop-up) */
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            /* WyÅ›rodkowanie punktu klikniÄ™cia */
            transform-origin: center center; 
        }

        .sparkle {
            position: absolute;
            font-size: 40px;
            pointer-events: none;
            animation: fadeUp 0.5s forwards;
            z-index: 6;
        }

        /* Modal KoÅ„ca Gry */
        #game-over-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 100;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
            color: white;
        }

        #game-over-modal h1 {
            font-size: 40px;
            margin-bottom: 10px;
            color: #ff6b6b;
        }

        .result-text {
            font-size: 24px;
            margin: 10px 0;
        }

        #reason-text {
            font-size: 18px;
            color: #ccc;
            margin-bottom: 20px;
            font-style: italic;
        }

        #restart-btn {
            margin-top: 20px;
            padding: 15px 40px;
            font-size: 24px;
            background-color: #4facfe;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
            transition: transform 0.1s;
        }

        #restart-btn:active {
            transform: scale(0.95);
        }

        /* Animacje */
        @keyframes popIn {
            0% { transform: scale(0); opacity: 0;}
            100% { transform: scale(1); opacity: 1;}
        }

        @keyframes fadeUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-30px) scale(1.5); }
        }

    </style>
</head>
<body>

    <div id="game-area">
        <div id="score-board">Punkty: <span id="score">0</span></div>
    </div>

    <div id="game-over-modal">
        <h1>KONIEC GRY ðŸ«§</h1>
        <div id="reason-text">...</div>
        <div class="result-text">Wynik: <span id="final-score">0</span></div>
        <div class="result-text">Rekord: <span id="best-score">0</span></div>
        <button id="restart-btn" onclick="restartGame()">Nowa Gra</button>
    </div>

    <script>
        let dawid108 = localStorage.getItem("dawid108") || 0;
        const gameArea = document.getElementById('game-area');
        const scoreEl = document.getElementById('score');
        const modal = document.getElementById('game-over-modal');
        const finalScoreEl = document.getElementById('final-score');
        const bestScoreEl = document.getElementById('best-score');
        const reasonTextEl = document.getElementById('reason-text');

        let score = 0;
        let gameActive = false;
        let activeBubbles = []; // Przechowuje referencje do baniek i ich timerÃ³w
        let spawnTimeout;

        // --- Parametry TrudnoÅ›ci ---
        let currentLifetime = 4000; // ZMIANA: Startowo 4 sekundy (wolniej znikajÄ…)
        let spawnRate = 1500;       // ZMIANA: Startowo 1.5 sekundy (wolniej siÄ™ pojawiajÄ…)

        // --- Start Gry ---
        function startGame() {
            score = 0;
            scoreEl.innerText = score;
            gameActive = true;
            modal.style.display = 'none';
            
            // Reset trudnoÅ›ci
            currentLifetime = 4000; 
            spawnRate = 1500;

            // WyczyÅ›Ä‡ planszÄ™
            activeBubbles.forEach(b => {
                if(b.timer) clearTimeout(b.timer);
                if(b.el.parentNode) b.el.remove();
            });
            activeBubbles = [];

            // Pierwsza baÅ„ka
            spawnBubbleLoop();
        }

        // --- PÄ™tla Tworzenia Baniek ---
        function spawnBubbleLoop() {
            if (!gameActive) return;

            createBubble();

            // Ustal czas do nastÄ™pnej baÅ„ki
            spawnTimeout = setTimeout(spawnBubbleLoop, spawnRate);
        }

        // --- Tworzenie Pojedynczej BaÅ„ki ---
        function createBubble() {
            const bubble = document.createElement('div');
            bubble.classList.add('bubble');
            bubble.innerText = 'ðŸ«§';

            // Losowa pozycja (z marginesem)
            const size = 80; 
            const maxX = window.innerWidth - size;
            const maxY = window.innerHeight - size;
            
            const x = Math.random() * maxX;
            const y = Math.random() * maxY;

            bubble.style.left = x + 'px';
            bubble.style.top = y + 'px';

            // ZMIANA: Sprawdzenie czy to pierwsza baÅ„ka
            // Pierwsza baÅ„ka to taka, gdy wynik jest 0 I nie ma innych aktywnych
            const isFirstBubble = (score === 0 && activeBubbles.length === 0);

            let deathTimer = null;

            if (isFirstBubble) {
                // ZMIANA: Pierwsza baÅ„ka nie znika
                bubble.style.transform = 'scale(1)'; // Ustawiamy staÅ‚y rozmiar
                // Nie ustawiamy transition ani deathTimer
            } else {
                // Standardowe baÅ„ki
                // Animacja zmniejszania siÄ™ (wizualizacja czasu)
                bubble.style.transition = `transform ${currentLifetime}ms linear`;
                
                // Hack, Å¼eby wymusiÄ‡ start animacji po dodaniu do DOM
                setTimeout(() => {
                     bubble.style.transform = 'scale(0)'; 
                }, 400); // MaÅ‚e opÃ³Åºnienie dla pewnoÅ›ci

                // Timer Å›mierci
                deathTimer = setTimeout(() => {
                    if (gameActive) {
                        gameOver("Nie zdÄ…Å¼yÅ‚eÅ› zbiÄ‡ baÅ„ki!");
                    }
                }, currentLifetime);
            }

            // ObsÅ‚uga klikniÄ™cia
            bubble.addEventListener('pointerdown', (e) => popBubble(e, bubble, bubbleObj));

            gameArea.appendChild(bubble);

            const bubbleObj = { el: bubble, timer: deathTimer };
            activeBubbles.push(bubbleObj);
        }

        // --- Zbijanie BaÅ„ki ---
        function popBubble(e, bubbleEl, bubbleObj) {
            e.stopPropagation(); // WaÅ¼ne: zapobiega klikniÄ™ciu w tÅ‚o!
            if (!gameActive) return;

            // Zatrzymaj timer Å›mierci (jeÅ›li istnieje)
            if (bubbleObj.timer) clearTimeout(bubbleObj.timer);

            // UsuÅ„ z tablicy aktywnych
            activeBubbles = activeBubbles.filter(b => b !== bubbleObj);

            // Efekt wizualny pÄ™kniÄ™cia
            createSparkle(parseInt(bubbleEl.style.left), parseInt(bubbleEl.style.top));
            bubbleEl.remove();

            // Punkty
            score++;
            scoreEl.innerText = score;
            dawid108++;
            localStorage.setItem("dawid108", dawid108);
            console.log("dawid108:", dawid108);

            // ZwiÄ™kszanie trudnoÅ›ci
            increaseDifficulty();
        }

        // --- Efekt "BÅ‚ysku" (âœ¨) ---
        function createSparkle(x, y) {
            const sparkle = document.createElement('div');
            sparkle.classList.add('sparkle');
            sparkle.innerText = 'âœ¨';
            sparkle.style.left = (x + 20) + 'px'; 
            sparkle.style.top = (y + 20) + 'px';
            gameArea.appendChild(sparkle);

            setTimeout(() => sparkle.remove(), 500);
        }

        // --- Logika KlikniÄ™cia w TÅ‚o (PudÅ‚o) ---
        gameArea.addEventListener('pointerdown', (e) => {
            if (!gameActive) return;
            gameOver("PudÅ‚o! KliknÄ…Å‚eÅ› w tÅ‚o.");
        });

        // --- Skalowanie TrudnoÅ›ci ---
        function increaseDifficulty() {
            // Skracamy czas Å¼ycia (min. 600ms)
            if (currentLifetime > 600) {
                currentLifetime -= 50; // Szybciej skracamy czas
            }

            // Przyspieszamy pojawianie siÄ™ (min. 400ms)
            if (spawnRate > 400) {
                spawnRate -= 30; 
            }
        }

        // --- Koniec Gry ---
        function gameOver(reason) {
            gameActive = false;
            clearTimeout(spawnTimeout);
            
            // Zatrzymaj wszystkie istniejÄ…ce baÅ„ki
            activeBubbles.forEach(b => {
                if(b.timer) clearTimeout(b.timer);
            });

            // ObsÅ‚uga LocalStorage
            let bestScore = localStorage.getItem('banki') || 0;
            if (score > parseInt(bestScore)) {
                bestScore = score;
                localStorage.setItem('banki', bestScore);
            }

            // WypeÅ‚nij modal
            finalScoreEl.innerText = score;
            bestScoreEl.innerText = bestScore;
            reasonTextEl.innerText = reason;
            
            modal.style.display = 'flex';
        }

        function restartGame() {
            startGame();
        }

        startGame();

    </script>
</body>
</html>
