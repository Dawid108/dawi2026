<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Gwiazdor</title>
    <meta name="description" content="Gwiazdor">
    <meta name="author" content="Dawid Gustowski">

    <link rel="icon" href="./icon-512.png">
    <link rel="apple-touch-icon" href="./icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Dawid">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#1a1a2e">

    <script src="./script.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #1a1a2e; /* Ciemne to */
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden; /* Blokada paska przewijania */
            touch-action: none; /* Blokada gest贸w na telefonie */
            user-select: none;
        }

        #game-area {
            position: relative;
            width: 100vw;
            height: 100svh;
            overflow: hidden;
            cursor: none; /* Ukrywamy kursor systemowy, bo Mikoaj go zastpuje */
        }

        #player {
            position: absolute;
            bottom: 20px;
            font-size: 60px;
            /* Usunem transform, kt贸ry przesuwa mikoaja obok kursora */
            left: calc(50% - 30px); /* Startowo na rodku */
            z-index: 10;
            pointer-events: none; /* Wa偶ne: Mikoaj nie blokuje zdarze myszki */
        }

        .item {
            position: absolute;
            top: -60px;
            font-size: 40px;
            z-index: 5;
        }

        #score-board {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
            z-index: 20;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 15px;
            border-radius: 10px;
        }

        /* Ekran kocowy */
        #game-over-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 100;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
            cursor: default; /* Przywracamy kursor w menu */
        }

        #game-over-modal h1 {
            font-size: 40px;
            margin-bottom: 10px;
            color: #ff4d4d;
        }

        .result-text {
            font-size: 24px;
            margin: 10px 0;
        }

        #restart-btn {
            margin-top: 30px;
            padding: 15px 40px;
            font-size: 24px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
            transition: transform 0.2s;
        }

        #restart-btn:active {
            transform: scale(0.95);
        }

        #start-hint {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 20px;
            color: #ccc;
            pointer-events: none;
            text-align: center;
        }
    </style>
</head>
<body>

    <div id="game-area">
        <div id="score-board">Punkty: <span id="score">0</span></div>
        <div id="player"></div>
        <div id="start-hint">Dotknij i przesuwaj,<br>偶eby apa prezenty!</div>
    </div>

    <div id="game-over-modal">
        <h1>BOMBA! </h1>
        <div class="result-text">Wynik: <span id="final-score">0</span></div>
        <div class="result-text">Rekord: <span id="best-score">0</span></div>
        <button id="restart-btn" onclick="restartGame()">Nowa Gra</button>
    </div>

    <script>
        // --- ZMIENNE GRY ---
        const player = document.getElementById('player');
        const gameArea = document.getElementById('game-area');
        const scoreEl = document.getElementById('score');
        const modal = document.getElementById('game-over-modal');
        const finalScoreEl = document.getElementById('final-score');
        const bestScoreEl = document.getElementById('best-score');
        const startHint = document.getElementById('start-hint');

        let score = 0;
        let gameActive = true;
        let items = []; 
        let spawnTimeout;
        
        // Parametry trudnoci
        let speedMultiplier = 1;
        let spawnRate = 900; 

        // --- STEROWANIE ---
        
        function movePlayer(clientX) {
            if (!gameActive) return;
            
            startHint.style.display = 'none';

            const gameWidth = gameArea.offsetWidth;
            const playerWidth = player.offsetWidth; // ok. 60-80px zale偶nie od czcionki
            
            // CENTROWANIE: Pozycja to miejsce myszki MINUS poowa szerokoci Mikoaja
            let newLeft = clientX - (playerWidth / 2);
            
            // Blokada wyje偶d偶ania poza ekran
            if (newLeft < -20) newLeft = -20; // Lekki margines
            if (newLeft > gameWidth - playerWidth + 20) newLeft = gameWidth - playerWidth + 20;

            player.style.left = newLeft + 'px';
        }

        // Obsuga myszki (PC)
        document.addEventListener('mousemove', (e) => {
            movePlayer(e.clientX);
        });

        // Obsuga dotyku (Telefon)
        document.addEventListener('touchmove', (e) => {
            // e.preventDefault() jest kluczowe, 偶eby ekran nie skaka
            if(gameActive) e.preventDefault(); 
            movePlayer(e.touches[0].clientX);
        }, { passive: false });

        // --- MECHANIKA GRY ---

        function startGame() {
            score = 0;
            speedMultiplier = 1;
            spawnRate = 900;
            scoreEl.innerText = score;
            gameActive = true;
            
            modal.style.display = 'none';
            gameArea.style.cursor = 'none'; // Ukryj kursor podczas gry
            startHint.style.display = 'block';

            // Czyszczenie planszy
            items.forEach(item => item.element.remove());
            items = [];

            // Reset timer贸w
            clearTimeout(spawnTimeout);

            lastTime = performance.now();
            requestAnimationFrame(gameLoop);
            scheduleNextSpawn();
        }

        // Funkcja decydujca ILE przedmiot贸w spadnie naraz
        function spawnCluster() {
            if (!gameActive) return;

            // Szansa na liczbe przedmiotow:
            // 60% na 1 przedmiot
            // 30% na 2 przedmioty
            // 10% na 3 przedmioty
            // (Im wy偶szy poziom, tym wiksza szansa na 2 i 3 - opcjonalnie)
            
            let rand = Math.random();
            let count = 1;

            if (score > 10 && rand > 0.6) count = 2; // Od 10 punkt贸w zaczynaj spada po dwa
            if (score > 25 && rand > 0.85) count = 3; // Od 25 punkt贸w mog spa trzy

            for (let i = 0; i < count; i++) {
                spawnSingleItem();
            }

            scheduleNextSpawn();
        }

        function scheduleNextSpawn() {
            if (!gameActive) return;
            // Czas do nastpnego zrzutu
            let nextTime = spawnRate;
            if (nextTime < 400) nextTime = 400; // Minimalny odstp
            spawnTimeout = setTimeout(spawnCluster, nextTime);
        }

        // Tworzenie pojedynczego obiektu
        function spawnSingleItem() {
            const el = document.createElement('div');
            el.classList.add('item');
            
            // 30% szans na bomb (troch trudniej)
            const isBomb = Math.random() < 0.3; 
            
            el.innerText = isBomb ? '' : '';
            el.dataset.type = isBomb ? 'bomb' : 'gift';

            // Losowa pozycja X
            const maxLeft = gameArea.offsetWidth - 50;
            el.style.left = Math.floor(Math.random() * maxLeft) + 'px';
            
            gameArea.appendChild(el);

            // BAZOWA PRDKO ZWIKSZONA: (5 do 10 pikseli na klatk) * mno偶nik
            let baseSpeed = Math.random() * 5 + 5; 

            items.push({
                element: el,
                y: -60,
                speed: baseSpeed * speedMultiplier
            });
        }

        // G贸wna ptla gry (animacja spadania)
        function gameLoop() {
            if (!gameActive) return;

            for (let i = items.length - 1; i >= 0; i--) {
                let item = items[i];
                
                item.y += item.speed;
                item.element.style.top = item.y + 'px';

                // Usunicie po wypadniciu
                if (item.y > window.innerHeight) {
                    item.element.remove();
                    items.splice(i, 1);
                    continue;
                }

                // Kolizja
                if (checkCollision(player, item.element)) {
                    if (item.element.dataset.type === 'gift') {
                        score++;
                        scoreEl.innerText = score;
                        increaseDifficulty();
                        
                        item.element.remove();
                        items.splice(i, 1);
                    } else {
                        gameOver();
                        return;
                    }
                }
            }

            requestAnimationFrame(gameLoop);
        }

        function checkCollision(playerDiv, itemDiv) {
            // Zmniejszamy obszar kolizji gracza (hitbox), 偶eby byo uczciwiej
            // Bierzemy 70% wielkoci mikoaja jako obszar trafienia
            const pRect = playerDiv.getBoundingClientRect();
            const iRect = itemDiv.getBoundingClientRect();
            
            const hitBoxMargin = pRect.width * 0.2; // 20% marginesu z ka偶dej strony

            return !(
                pRect.top + hitBoxMargin > iRect.bottom ||
                pRect.right - hitBoxMargin < iRect.left ||
                pRect.bottom - hitBoxMargin < iRect.top ||
                pRect.left + hitBoxMargin > iRect.right
            );
        }

        function increaseDifficulty() {
            // Szybszy wzrost trudnoci
            if (score % 5 === 0) {
                speedMultiplier += 0.1; // Szybciej spadaj
                spawnRate -= 40;        // Czciej si pojawiaj
            }
        }

        function gameOver() {
            gameActive = false;
            clearTimeout(spawnTimeout);
            
            gameArea.style.cursor = 'default'; // Przywr贸 kursor

            let bestScore = localStorage.getItem('gwiazdor') || 0;
            if (score > parseInt(bestScore)) {
                bestScore = score;
                localStorage.setItem('gwiazdor', bestScore);
            }

            finalScoreEl.innerText = score;
            bestScoreEl.innerText = bestScore;
            
            modal.style.display = 'flex';
        }

        function restartGame() {
            startGame();
        }

        startGame();

    </script>
</body>
</html>
