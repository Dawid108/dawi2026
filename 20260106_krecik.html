<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Krecik</title>
    <meta name="description" content="Krecik">
    <meta name="author" content="Dawid Gustowski">

    <link rel="icon" href="./icon-512.png">
    <link rel="apple-touch-icon" href="./icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Dawid">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#8da25d">

    <script src="./script.js"></script>
    <style>
        body {
            background-color: #8da25d;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            user-select: none;
            overflow: hidden;
            touch-action: manipulation;
        }

        h1 {
            color: #fff;
            text-shadow: 2px 2px 0 #3e4a2a;
            margin: 0 0 15px 0;
            font-size: 28px;
            text-align: center;
        }

        /* HUD - Czas i Wynik */
        .hud {
            display: flex;
            gap: 20px;
            font-size: 24px;
            color: white;
            font-weight: bold;
            margin-bottom: 15px;
            background: rgba(0,0,0,0.3);
            padding: 10px 20px;
            border-radius: 15px;
            text-shadow: 1px 1px 2px black;
        }

        /* Siatka gry - Desktop (3 kolumny) */
        .game-grid {
            display: flex;
            flex-wrap: wrap;
            width: 600px;
            height: auto;
            justify-content: center;
            gap: 15px; /* Odstƒôp miƒôdzy dziurami */
        }

        .hole {
            /* Desktop: ok. 30% szeroko≈õci daje 3 elementy w rzƒôdzie */
            width: 30%; 
            height: 140px;
            position: relative;
            overflow: hidden;
            cursor: crosshair; /* Zmieniamy kursor na celownik, ≈ºeby sugerowaƒá precyzjƒô */
        }

        /* WyglƒÖd dziury (ziemia) */
        .hole::after {
            content: '';
            display: block;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 50"><ellipse cx="50" cy="25" rx="40" ry="15" fill="%233e2723" /></svg>') no-repeat bottom center;
            background-size: contain;
            width: 100%;
            height: 70px;
            position: absolute;
            bottom: -8px;
            z-index: 2;
            pointer-events: none;
        }

        /* Krecik */
        .mole {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 100%;
            text-align: center;
            font-size: 80px;
            line-height: 140px;
            cursor: pointer;
            transition: top 0.1s ease-out;
            z-index: 1;
        }

        .hole.up .mole {
            top: 0;
        }

        /* Modal */
        #game-over-modal {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            z-index: 10;
            color: white;
        }

        h2 { font-size: 36px; color: #f1c40f; margin-bottom: 20px; }
        .stat-box { font-size: 26px; margin: 10px 0; }
        .highlight { color: #2ecc71; font-weight: bold; }

        button {
            margin-top: 30px;
            padding: 15px 40px;
            font-size: 22px;
            background-color: #e67e22;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 5px #d35400;
        }
        button:active { transform: translateY(2px); box-shadow: 0 2px #d35400; }

        /* --- STYL DLA TELEFON√ìW --- */
        @media (max-width: 640px) {
            h1 { font-size: 24px; margin-bottom: 10px; }
            .hud { font-size: 20px; padding: 8px 15px; margin-bottom: 10px; }

            .game-grid {
                width: 95%; /* Dopasuj do szeroko≈õci ekranu */
                max-width: 400px;
                gap: 10px;
            }

            .hole {
                /* Mobile: 45% szeroko≈õci wymusza 2 elementy w rzƒôdzie (45% + 45% + gap < 100%) */
                width: 45%; 
                height: 110px; /* Nieco ni≈ºsze dziury, ≈ºeby 3 rzƒôdy siƒô zmie≈õci≈Çy */
            }

            .mole {
                font-size: 65px; /* Mniejszy krecik */
                line-height: 110px;
            }
            
            .hole::after {
                height: 50px; /* Mniejsza zaspa ziemi */
                bottom: -5px;
            }
        }
    </style>
</head>
<body>

    <h1>Krecik</h1>

    <div class="hud">
        <div>Czas: <span id="time-display">30</span>s</div>
        <div>Wynik: <span id="score-display">0</span></div>
    </div>

    <div class="game-grid">
        <div class="hole"><div class="mole">üêπ</div></div>
        <div class="hole"><div class="mole">üêπ</div></div>
        <div class="hole"><div class="mole">üêπ</div></div>
        <div class="hole"><div class="mole">üêπ</div></div>
        <div class="hole"><div class="mole">üêπ</div></div>
        <div class="hole"><div class="mole">üêπ</div></div>
    </div>

    <div id="game-over-modal">
        <h2>Koniec Gry!</h2>
        <div class="stat-box" style="display:none">Wynik: <span id="final-score" class="highlight">0</span></div>
        <div class="stat-box" style="display:none">Rekord: <span id="best-score" class="highlight">0</span></div>
        <button onclick="startGameWrapper()">Start Gry ‚ñ∂Ô∏è</button>
    </div>

<script>
    let dawid108 = localStorage.getItem("dawid108") || 0;
    const holes = document.querySelectorAll('.hole');
    const moles = document.querySelectorAll('.mole');
    const scoreDisplay = document.getElementById('score-display');
    const timeDisplay = document.getElementById('time-display');
    const modal = document.getElementById('game-over-modal');
    const finalScoreEl = document.getElementById('final-score');
    const bestScoreEl = document.getElementById('best-score');
    const modalBtn = document.querySelector('#game-over-modal button');
    const modalTitle = document.querySelector('#game-over-modal h2');
    const statBoxes = document.querySelectorAll('.stat-box');

    let lastHole;
    let timeUp = false;
    let score = 0;
    let timeLeft = 30;
    let gameTimerInterval;
    let moleTimeout;
    let gameStarted = false; // Flaga sprawdzajƒÖca czy gra trwa

    function randomTime(min, max) {
        return Math.round(Math.random() * (max - min) + min);
    }

    function randomHole(holes) {
        const idx = Math.floor(Math.random() * holes.length);
        const hole = holes[idx];
        if (hole === lastHole) return randomHole(holes);
        lastHole = hole;
        return hole;
    }

    function peep() {
        if (timeUp) return;
        const time = randomTime(600, 1200);
        const hole = randomHole(holes);
        hole.classList.add('up');

        moleTimeout = setTimeout(() => {
            hole.classList.remove('up');
            if (!timeUp) peep();
        }, time);
    }

    function startGame() {
        scoreDisplay.textContent = 0;
        timeDisplay.textContent = 30;
        score = 0;
        timeLeft = 30;
        timeUp = false;
        gameStarted = true;
        modal.style.display = 'none';
        holes.forEach(hole => hole.classList.remove('up'));
        
        peep();

        gameTimerInterval = setInterval(() => {
            timeLeft--;
            timeDisplay.textContent = timeLeft;
            if (timeLeft <= 0) endGame("time");
        }, 1000);
    }

    // Wrapper potrzebny do zmiany tekstu w modalu po pierwszej grze
    function startGameWrapper() {
        statBoxes.forEach(el => el.style.display = 'block');
        modalBtn.innerText = "Nowa Gra üîÑ";
        modalBtn.onclick = startGame; 
        startGame();
    }

    function bonk(e) {
        if (!e.isTrusted) return;
        
        // --- KLUCZOWA ZMIANA 1: Zatrzymujemy propagacjƒô ---
        // Dziƒôki temu klikniƒôcie w krecika nie jest liczone jako klikniƒôcie w dziurƒô (pud≈Ço)
        e.stopPropagation(); 

        const hole = this.parentNode;
        if(!hole.classList.contains('up')) return;

        score++;
        dawid108++;
        localStorage.setItem("dawid108", dawid108);
        console.log("dawid108:", dawid108);
        hole.classList.remove('up');
        scoreDisplay.textContent = score;

        clearTimeout(moleTimeout);
        setTimeout(() => peep(), 100);
    }

    // --- KLUCZOWA ZMIANA 2: Funkcja obs≈ÇugujƒÖca pud≈Ço ---
    function miss(e) {
        if (!gameStarted || timeUp) return; // Je≈õli gra nie trwa, ignoruj
        
        // Je≈õli kliknƒôli≈õmy w dziurƒô (a bonk nie zatrzyma≈Ç zdarzenia), to znaczy ≈ºe pud≈Ço
        endGame("miss");
    }

    function endGame(reason) {
        timeUp = true;
        gameStarted = false;
        clearInterval(gameTimerInterval);
        clearTimeout(moleTimeout);
        holes.forEach(hole => hole.classList.remove('up'));

        const savedRecord = localStorage.getItem('krecik');
        let record = savedRecord ? parseInt(savedRecord) : 0;
        if (score > record) {
            record = score;
            localStorage.setItem('krecik', record);
        }

        // --- Zmiana tytu≈Çu zale≈ºnie od powodu ko≈Ñca gry ---
        if (reason === "miss") {
            modalTitle.innerText = "Pud≈Ço! Koniec gry üíÄ";
            modalTitle.style.color = "#e74c3c"; // Czerwony kolor dla przegranej
        } else {
            modalTitle.innerText = "Czas minƒÖ≈Ç!";
            modalTitle.style.color = "#f1c40f"; // ≈ª√≥≈Çty kolor standardowy
        }

        finalScoreEl.innerText = score;
        bestScoreEl.innerText = record;
        modal.style.display = 'flex';
    }

    // Dodanie event listener√≥w do krecik√≥w
    moles.forEach(mole => mole.addEventListener('click', bonk));
    moles.forEach(mole => mole.addEventListener('touchstart', bonk));
    
    // --- KLUCZOWA ZMIANA 3: Dodanie listener√≥w do dziur (pud≈Ça) ---
    holes.forEach(hole => {
        hole.addEventListener('click', miss);
        // Opcjonalnie touchstart na dziurach, ale click zazwyczaj wystarcza i jest bezpieczniejszy
        // ≈ºeby nie dublowaƒá zdarze≈Ñ na mobile
    });

    // Inicjalizacja modalu
    modal.style.display = 'flex';

</script>
</body>
</html>
